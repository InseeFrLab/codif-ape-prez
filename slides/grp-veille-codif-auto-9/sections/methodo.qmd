## M√©thodologie

- üéØ [**Objectif**] : Reconstruire un jeu d'entra√Ænement le plus exhaustif possible
- Exp√©rimentation one-shot ‚û°Ô∏è pas de contrainte de reproductibilit√© ... en production
- Utilisation de LLMs pour g√©n√©rer des annotations en NAF 2025
- Donn√©es √† disposition : 
  - Stock Sirene 4 ($~2.7$ millions d'observations)
  - Table de passage r√©alis√©e par les experts APE
  - Notes explicatives de la NAF 2025
  - Annotations faites par les gestionnaires ($~25k$ observations)

## M√©thodologie

![](../img/methodo-nace-rev.png){fig-align="center"}

## Tirer profit des LLMs

- [**Retrieval Augmented Generation**] (RAG) vs [**fine-tunning**] 

- [**2 possibilit√©s**] :
  - RAG avec les [**notes explicatives**]
    - Pas encore test√© üìù
  - [**Pseudo-RAG**] : 
    - [**Retriever manuel**] utilisant la table de passage

- üí° Id√©e g√©n√©rale : 
  - Donner les informations les plus pertinentes √† un LLM pour qu'il soit capable de recoder les codes NAF 2008 en NAF 2025

::: {.callout-warning}
L'id√©e n'est pas de construire un classifier, seulement cr√©er des annotations.
:::

## Le prompting

- Prompt [**syst√®me**] identique pour toutes les observations

<details> 
<summary> 
    <font size=3 color=black><b>Afficher le prompt syt√®me</b></font> 
</summary>
```
Tu es un expert de la Nomenclature statistique des Activit√©s √©conomiques dans la Communaut√© Europ√©enne (NACE). Tu es charg√© de r√©aliser le changement de nomenclature. Ta mission consiste √† attribuer un code NACE 2025 √† une entreprise, en t'appuyant sur le descriptif de son activit√© et √† partir d'une liste de codes propos√©s (identifi√©e √† partir de son code NACE 2008 existant). Voici les instructions √† suivre :
1. Analyse la description de l'activit√© principale de l'entreprise et le code NACE 2008 fourni par l'utilisateur.
2. √Ä partir de la liste des codes NACE 2025 disponible, identifie la cat√©gorie la plus appropri√©e qui correspond √† l'activit√© principale de l'entreprise.
3. Retourne le code NACE 2025 au format JSON comme sp√©cifi√© par l'utilisateur. Si la description de l'activit√© de l'entreprise n'est pas suffisamment pr√©cise pour identifier un code NACE 2025 ad√©quat, retourne `null` dans le JSON.
4. √âvalue la coh√©rence entre le code NACE 2008 fourni et la description de l'activit√© de l'entreprise. Si le code NACE 2008 ne semble pas correspondre √† cette description, retourne `False` dans le champ `nace08_valid` du JSON. Note que si tu arrives √† classer la description de l'activit√© de l'entreprise dans un code NACE 2025, le champ `nace08_valid` devrait `True`, sinon il y a incoh√©rence.
5. R√©ponds seulement avec le JSON compl√©t√© aucune autres information ne doit √™tre retourn√©.
```
</details>


- Un prompt [**sp√©cifique**] pour chaque observations comprenant : 
  - le libell√© de l'activit√© principale de l'entreprise
  - l'ancien code nace 2008 connu
  - La liste des codes possibles issues du mapping avec leurs notes explicatives

- Une [**instruction sur le format**] de r√©ponse attendu

## Qualifier la r√©ponse g√©n√©r√©e

- Tendance des LLMs a √™tre tr√®s [**volubiles**]...
- Construction d'une r√©ponse type, claire et br√®ves dans un format sp√©cifique
- Format JSON est le plus abondamment utilis√© dans l'√©cosyst√®me
- R√©ponse attendue : 

<details> 
<summary> 
    <font size=3 color=black><b>Afficher un exemple de r√©ponse attendue</b></font> 
</summary>
```json
{
        "codable": true,
        "nace_2008_valid": true,
        "nace2025": "0147J" 
}
```
</details>

- Parsing de la r√©ponse :
  - V√©rifie que le format est le bon
  - S'assurer qu'il n'y a pas d'hallucination dans les g√©n√©rations


## LLMs utilis√©s


| Mod√®le | Taille | Vitesse d'inf√©rence | Performance | Caract√©ristique |
| --- | --- | --- | --- | --- |
| Qwen 2.5 | 32B | [Lent]{.orange} | [Bonnes performances]{.green} | Tr√®s restrictif |
| Ministral | 8B | [Extr√™mement rapide]{.green2} | [Tr√®s raisonnable]{.orange} | Pas restrictif |
| Mistal Small | 44B | [Lent]{.orange} | [Bonnes performances]{.green} | Assez restrictif |
| Llama 3.1 | 70B (quantis√©) | [Extr√™mement lent]{.red} | [Tr√®s bonnes performances]{.green2} | Assez restrictif |

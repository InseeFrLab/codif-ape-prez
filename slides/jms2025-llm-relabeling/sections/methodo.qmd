## M√©thodologie { .smaller}

- üéØ [**Objectif**]{.orange} : Reconstruire un jeu d'entra√Ænement le plus exhaustif possible
- üí°[**Principe**]{.orange} : consid√©rer les LLMs comme des [**annotateurs virtuels**]{.blue2} 

![](../img/methodo-nace-rev.png){fig-align="center"}

::: notes
Le principe est de reproduire le travail des experts par LLM et de s√©lectionner le mod√®le qui s‚Äôaligne le mieux avec les annotations manuelles.

Les cas univoques sont recod√©s via une table de correspondance.

Les cas multivoques sont recod√©s via LLM.
Cela permet de cr√©er une base d‚Äôapprentissage volumineuse pour entra√Æner le classifieur.

En r√©sum√© : les multivoques sont labellis√©s virtuellement par LLM.
:::

## Le prompting {.scrollable}

- Prompt [**syst√®me**]{.orange} identique pour toutes les observations

  <details> 
  <summary> 
      <font size=3 color=black><b>Afficher le prompt syt√®me</b></font> 
  </summary>

  ```
  Tu es un expert de la Nomenclature statistique des Activit√©s √©conomiques dans la Communaut√© Europ√©enne (NACE). Tu es charg√© de r√©aliser le changement de nomenclature. Ta mission consiste √† attribuer un code NACE 2025 √† une entreprise, en t'appuyant sur le descriptif de son activit√© et √† partir d'une liste de codes propos√©s (identifi√©e √† partir de son code NACE 2008 existant). Voici les instructions √† suivre :
  1. Analyse la description de l'activit√© principale de l'entreprise et le code NACE 2008 fourni par l'utilisateur.
  2. √Ä partir de la liste des codes NACE 2025 disponible, identifie la cat√©gorie la plus appropri√©e qui correspond √† l'activit√© principale de l'entreprise.
  3. Retourne le code NACE 2025 au format JSON comme sp√©cifi√© par l'utilisateur. Si la description de l'activit√© de l'entreprise n'est pas suffisamment pr√©cise pour identifier un code NACE 2025 ad√©quat, retourne `null` dans le JSON.
  4. √âvalue la coh√©rence entre le code NACE 2008 fourni et la description de l'activit√© de l'entreprise. Si le code NACE 2008 ne semble pas correspondre √† cette description, retourne `False` dans le champ `nace08_valid` du JSON. Note que si tu arrives √† classer la description de l'activit√© de l'entreprise dans un code NACE 2025, le champ `nace08_valid` devrait `True`, sinon il y a incoh√©rence.
  5. R√©ponds seulement avec le JSON compl√©t√© aucune autres information ne doit √™tre retourn√©.
  ```

  </details>

- Un prompt [**sp√©cifique**]{.orange} pour chaque observation comprenant : 
  - le [**libell√©**]{.blue2} de l'activit√© principale de l'entreprise
  - l'ancien [**code NAF 2008**]{.blue2} connu
  - La [**liste des codes possibles**]{.blue2} issues du mapping avec leurs [**notes explicatives**]{.blue2}

- Une [**instruction sur le format**]{.orange} de r√©ponse attendu

<details> 
<summary> 
    <font size=3 color=black><b>Afficher un exemple de r√©ponse attendue</b></font> 
</summary>

```json
{
    "codable": true,
    "nace_2008_valid": true,
    "nace2025": "0147J" 
}
```

</details>



::: notes
Le LLM a besoin de directives claires pour produire des r√©ponses fiables :
Prompt syst√®me : d√©finit sa feuille de route globale, lui donne un r√¥le d‚Äôexpert NACE. C‚Äôest un exemple parmi les nombreuses techniques du prompt engineering pour optimiser les LLM.
Prompt sp√©cifique : fourni pour chaque observation, avec les informations n√©cessaires pour coder correctement, et surtout pour ajouter le contexte. Nous verrons quelques exemples pour comprendre pourquoi c‚Äôest crucial.
Consigne de format : pour √©viter les r√©ponses volubiles ou incorrectes et garantir une sortie structur√©e et exploitable.
:::


## Importance du contexte

![](../img/hallucination.drawio.png){fig-align="center"}

::: notes
Sans contexte suffisant, le LLM peut halluciner, c‚Äôest-√†-dire fournir des r√©ponses incorrectes ou invent√©es.
Pour coder correctement en NAF 2025, il est indispensable de lui fournir le contexte n√©cessaire.
:::

##  Illustration avec ChatGPT

### R√©ponse format√©e

![](../img/hallucination_chatgpt_NAF_2025.png){fig-align="center"}

::: notes
En donnant le prompt syst√®me sans le prompt sp√©cifique qui apporte le contexte,
le LLM ne conna√Æt pas la NAF 2025 et donne le bon code certes mais en NAF rev 2, ce qui est faux
:::

##  Illustration avec ChatGPT

### R√©ponse non format√©e

![](../img/demande_contexte_chatgpt_NAF_2025.png){fig-align="center"}

::: notes
Sans demander de formater la r√©ponse, il comprend qu'il y a besoin de consulter la NAF 2025 
mais il a fallu une it√©ration suppl√©mentaire, ce qui est co√ªteux dans le contexte d'inf√©rence par batch.
:::

## Injection du contexte

![](../img/cag_application_naf.png){fig-align="center"}*

::: notes
C'est pour cela que l'on ajoute du contexte.
Il existe diff√©rentes techniques dont la plus populaire est le RAG.
Le sch√©ma pr√©sente le contexte inject√© qui constitue notre prompt sp√©cifique ou requ√™te.
La quantit√© de texte que le LLM peut examiner est appel√©e fen√™tre de contexte (sur le sch√©ma, rep√©r√©e comme ‚Äúfen√™tre √©tendue‚Äù).
:::
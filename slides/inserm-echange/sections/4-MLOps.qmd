## Situation actuelle inefficace

- [**Infrastructure**]{.orange} divergente : 
    - Mod√®le entrain√© sur la plateforme [**SSP Cloud**]{.blue2} üòç
    - Module de codification [**d√©velopp√© en Java**]{.blue2} au sein d'une architecture monolithique üò´
    - [**Duplication de code**]{.blue2} et risque d'erreurs 

## Situation actuelle inefficace

- Probl√®mes [**organisationnels**]{.orange} : 
    - [**M√©connaissance des probl√®mes m√©tier**]{.blue2} c√¥t√© Lab pour la maintenance
    - [**Contr√¥le de version**]{.blue2} et [**transmission**]{.blue2} des mod√®les non centralis√©s
    - Organisation [**inefficace**]{.blue2} entre les parties prenantes

## Situation actuelle inefficace

- [**Sp√©cificit√©s du ML**]{.orange} non prises en compte :
  - Pas de [**surveillance**]{.blue2} du mod√®le en temps r√©el
  - Pas de donn√©es [**golden standard**]{.blue2}
  - Pas de [**r√©-entrainement**]{.blue2} r√©gulier

- [**Cons√©quence**]{.orange} : Besoin d'adopter les [**bonnes pratiques**]{.blue2} d'un point de vue technique (MLOps) et organisationel

![](../img/mlops-cycle.png){fig-align="center"}

## Notre impl√©mentation MLOps üöÄ

- Architecture en microservices qui tournent sur un [**cluster Kubernetes**]{.orange} :
  - Contr√¥le de version des exp√©rimentations et mod√®les : [**MLflow**]{.blue2}
  - Mise √† dispostion du mod√®le via API: [**FastAPI**]{.blue2}
  - Automatisation avec [**ArgoCD**]{.blue2}
  - Dashboard de surveillance : [**Quarto**]{.blue2} and [**DuckDB**]{.blue2}
  - Contr√¥le qualit√©: annotations avec [**Label Studio**]{.blue2}

## MLflow au coeur de notre projet

![](../img/mlflow-model-registry.png){fig-align="center"}


##  Exposer un mod√®le via une API

- Mod√®le mis √† disposition via une [**API**]{.orange} conteneuris√©e :
  - [**Simple**]{.blue2} pour les utilisateurs
  - [**Format de requ√™te standard**]{.blue2}
  - Passage √† l'[**√©chelle**]{.blue2} optimis√©
  - [**Modulaire**]{.blue2} et [**portable**]{.blue2}
- D√©ploiement continu avec [**Argo CD**]{.orange}

##  Exposer un mod√®le via une API


```{ojs}
viewof activite = Inputs.text( 
  {label: '', value: 'Institut National de la Sant√© Et de la Recherche M√©dicale (INSERM)', width: 1200}
)

urlApe = `https://codification-ape-test.lab.sspcloud.fr/predict?nb_echos_max=3&prob_min=0&text_feature=${activite}&type_liasse=C&event=01P`

d3.json(urlApe).then( res => {
  var IC, results;
  ( {IC, ...results} = res )

  IC = parseFloat(IC)

  const rows = Object.values(results).map( obj => {
    return `
    <tr>
      <td>${obj.code} | ${obj.libelle}</td>
      <td>${obj.probabilite.toFixed(3)}</td>
    </tr>
  `
  }).join('')
  
  return html`
  <table>
    <caption>
      Indice de confiance : ${IC.toFixed(3)}
    </caption>
    <tr>
      <th style="text-align:center;">Libell√© (NA2008)</th>
      <th>Probabilit√©</th>
    </tr>
      ${rows}
  </table>`
})
```


```{ojs}
import { debounce } from "@mbostock/debouncing-input" 
```



## Exposer un mod√®le via une API

![](../img/api-datalab.png){fig-align="center"}

## Monitoring 

- [**Surveiller**]{.orange} un mod√®le ML en production est n√©cessaire :
  - Pour d√©tecter des [**distribution drifts**]{.blue2} dans les donn√©es d'entr√©es
  - Pour s'assurer qu'il a un [**comportement stable**]{.blue2}
  - Pour savoir [**quand r√©-entra√Æner**]{.blue2} le mod√®le
- Id√©allement, on voudrait conna√Ætre la [**performance en temps r√©el**]{.orange} mais compliqu√©.. et co√ªteux !
- Surveillance [**technique**]{.orange} aussi importante : [**latence**]{.orange}, [**memoire**]{.orange}, [**usage disque**]{.orange}, etc.


## Monitoring 

![](../img/monitoring-datalab){fig-align="center"}

## Contr√¥le qualit√©

- Donn√©es de test [**collect√©es et annot√©es p√©riodiquement**]{.orange}
- Annotation r√©alis√©e avec [**Label Studio**]{.orange}
- [**M√©triques de performance**]{.orange} calcul√©es sur le jeu de test
- Performance affich√©e dans un [**dashboard de surveillance**]{.orange}
- [**R√©-entra√Ænement**]{.orange} d√©clench√© lorsque certaines m√©triques passent un certain seuil (pas encore fait)

## Contr√¥le qualit√©

![](../img/annotation-datalab.png){fig-align="center"}

## Dashboard

[Tableau de bord](https://dashboard-ape.lab.sspcloud.fr/){preview-link="true"}
